<!DOCTYPE html>
<html>
    <head>
        <title>查找附近的店铺</title>
        <script src="http://api.map.baidu.com/api?v=1.3" type="text/javascript">
        </script>
        <script type="text/javascript" src="__STATIC__/css/convertor.js">
        </script>
    </head>
    <body>
        <div id="map" style="width:600px; height:400px">
          
        </div>
        <form action="" method="post">
		        经度：<input type="text" name="longitude" value="" id="longitude">
		         纬度：   <input type="text" name="latitude" value="" id="latitude">
		         <input type="submit" value="查找附近的店铺">
         </form>
         <if condition="$searchNear eq 'Y'">
        	 查找到附近<span style="red">{$countShop}</span>家店铺
         <div>         
         <volist name="nearShop" id="Shop">
           {$Shop.name} 距离约{$Shop.nearJuli}公里     <a href="{:U('index/navigate',array('start_point_lat'=>$start_point_lat,'start_point_lng'=>$start_point_lng,'end_point_lat'=>$Shop['latitude'],'end_point_lng'=>$Shop['longitude']))}">带我去！</a><br>
         </volist>
         </div>
         </if>
    </body>
    <script type="text/javascript">
        if (window.navigator.geolocation) {
            var options = {
                enableHighAccuracy: true,
            };
            window.navigator.geolocation.getCurrentPosition(handleSuccess, handleError, options);
        } else {
            alert("浏览器不支持html5来获取地理位置信息");
        }
        
        function handleSuccess(position){
            // 获取到当前位置经纬度  本例中是chrome浏览器取到的是google地图中的经纬度
            var lng = position.coords.longitude;
            var lat = position.coords.latitude;
            
    
            document.getElementById("longitude").value=lng;
            document.getElementById("latitude").value=lat;
            
            // 调用百度地图api显示
            var map = new BMap.Map("map");
            var ggPoint = new BMap.Point(lng, lat);
            // 将google地图中的经纬度转化为百度地图的经纬度
            BMap.Convertor.translate(ggPoint, 2, function(point){
                var marker = new BMap.Marker(point);
                map.addOverlay(marker);
                map.centerAndZoom(point, 15);
            });
        }
        
        function handleError(error){
        
        }
    </script>
</html>