<!DOCTYPE html>
<html>
    <head>
        <title>查找附近的店铺</title>
        <script src="http://api.map.baidu.com/api?v=1.3" type="text/javascript">
        </script>
        <script type="text/javascript" src="__STATIC__/css/convertor.js">
        </script>
    </head>
    <include file="public:headtop" />
    <include file="public:head" />
    <body>
        <div id="map" style="width:600px; height:400px;display:none;">
          
        </div>
        
         <div class="brandimg">
         <img id="brandimg" alt="Dior" src="__STATIC__/weixin/images/luxury/images/brand/post_06.png">
         </div>
         <form action="" method="post">
		        <input type="hidden" name="longitude" value="" id="longitude">
		        <input type="hidden" name="latitude" value="" id="latitude">
		         <input type="submit" value="查找附近的店铺">
         </form>
         <if condition="$searchNear eq 'Y'">
        	<span class="haveSearch"> 查找到附近<span style="red">{$countShop}</span>家店铺</span>
         <div>         
         <volist name="nearShop" id="Shop">
          <div class="shopSearch">
           <table>
           <tr><td width="85%">{$Shop.name}</td><td width="13%"> <a href="{:U('index/navigate',array('start_point_lat'=>$start_point_lat,'start_point_lng'=>$start_point_lng,'end_point_lat'=>$Shop['latitude'],'end_point_lng'=>$Shop['longitude']))}">
           <img height="27" width="58" src="__STATIC__/weixin/images/luxury/images/brand/tell_09.png" /></a><br></td></tr>
           <tr><td><span class="shop_address">{$Shop.address}</span></td>
           <td><img height="18" width="12" src="__STATIC__/weixin/images/luxury/images/brand/here_13.png"><span class="shop_address">{$Shop.nearJuli} KM</span></td></tr>
           </table>

          </div>
         </volist>
         </div>
         </if>
    </body>
    <script type="text/javascript">
        if (window.navigator.geolocation) {
            var options = {
                enableHighAccuracy: true,
            };
            window.navigator.geolocation.getCurrentPosition(handleSuccess, handleError, options);
        } else {
            alert("浏览器不支持html5来获取地理位置信息");
        }
        
        function handleSuccess(position){
            // 获取到当前位置经纬度  本例中是chrome浏览器取到的是google地图中的经纬度
            var lng = position.coords.longitude;
            var lat = position.coords.latitude;
            
    
            document.getElementById("longitude").value=lng;
            document.getElementById("latitude").value=lat;
            
            // 调用百度地图api显示
            var map = new BMap.Map("map");
            var ggPoint = new BMap.Point(lng, lat);
            // 将google地图中的经纬度转化为百度地图的经纬度
            BMap.Convertor.translate(ggPoint, 2, function(point){
                var marker = new BMap.Marker(point);
                map.addOverlay(marker);
                map.centerAndZoom(point, 15);
            });
        }
        
        function handleError(error){
        
        }
    </script>
</html>